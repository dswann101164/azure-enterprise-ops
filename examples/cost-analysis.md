# Cost Analysis and Optimization Examples

Practical examples for analyzing and optimizing Azure costs using Claude Desktop with MCP servers.

## Table of Contents

1. [Cost Discovery](#cost-discovery)
2. [Resource-Level Analysis](#resource-level-analysis)
3. [Optimization Opportunities](#optimization-opportunities)
4. [Reporting & Dashboards](#reporting--dashboards)
5. [Automation Scripts](#automation-scripts)
6. [Budget Management](#budget-management)

---

## Cost Discovery

### 1. Total Monthly Costs

**Prompt to Claude:**
```
Show me total Azure costs for the last 30 days, broken down by:
- Resource type
- Location
- Resource group
Generate a summary report
```

**PowerShell Script** (generated by Claude):

```powershell
# Get costs for last 30 days
$startDate = (Get-Date).AddDays(-30).ToString('yyyy-MM-dd')
$endDate = (Get-Date).ToString('yyyy-MM-dd')

# Query Azure Cost Management
$costs = az consumption usage list `
    --start-date $startDate `
    --end-date $endDate `
    --query "[].{Date:usageStart, ResourceGroup:instanceName, Type:consumedService, Cost:pretaxCost}" `
    --output json | ConvertFrom-Json

# Aggregate by resource type
$byType = $costs | Group-Object Type | ForEach-Object {
    [PSCustomObject]@{
        ResourceType = $_.Name
        TotalCost    = ($_.Group | Measure-Object Cost -Sum).Sum
        Resources    = $_.Count
        AvgPerResource = ($_.Group | Measure-Object Cost -Sum).Sum / $_.Count
    }
} | Sort-Object TotalCost -Descending

# Display results
Write-Host "`n=== Cost Summary (Last 30 Days) ===" -ForegroundColor Cyan
Write-Host "Total: `$$([math]::Round(($costs | Measure-Object Cost -Sum).Sum, 2))" -ForegroundColor Green

Write-Host "`n=== By Resource Type ===" -ForegroundColor Cyan
$byType | Format-Table -AutoSize

# Save to CSV
$byType | Export-Csv "costs-by-type-$(Get-Date -Format 'yyyyMMdd').csv" -NoTypeInformation
Write-Host "`nReport saved to: costs-by-type-$(Get-Date -Format 'yyyyMMdd').csv"
```

**Expected Output:**
```
=== Cost Summary (Last 30 Days) ===
Total: $127.45

=== By Resource Type ===
ResourceType                TotalCost  Resources  AvgPerResource
------------                ---------  ---------  --------------
Microsoft.Compute/VMs            78.50         3           26.17
Microsoft.Storage/Accounts       28.75         5            5.75
Microsoft.Network/PublicIPs      15.20         2            7.60
Microsoft.KeyVault/Vaults         5.00         1            5.00

Report saved to: costs-by-type-20251117.csv
```

---

### 2. Cost Trending

**Prompt to Claude:**
```
Analyze cost trends over the last 90 days.
Show me:
- Daily cost averages
- Week-over-week changes
- Any unusual spikes
Create a visualization
```

**Azure Resource Graph Query:**

```kusto
// Cost trending (last 90 days)
let lookback = 90d;
ConsumptionUsageDetails
| where TimeGenerated > ago(lookback)
| extend Date = format_datetime(TimeGenerated, 'yyyy-MM-dd')
| summarize DailyCost = sum(PretaxCost) by Date
| order by Date asc
| extend 
    WeekAvg = row_window_session_start(DailyCost, 7, 7),
    TrendDirection = iff(DailyCost > row_window_session_start(DailyCost, 7, 7), "Up", "Down")
| project Date, DailyCost, WeekAvg, TrendDirection
```

**Visualization** (Mermaid chart generated by Claude):

```mermaid
graph LR
    A[Week 1: $420] --> B[Week 2: $385]
    B --> C[Week 3: $445]
    C --> D[Week 4: $520]
    
    style A fill:#90EE90
    style B fill:#90EE90
    style C fill:#FFD700
    style D fill:#FF6347
```

**Analysis:**
```markdown
# Cost Trend Analysis (Last 90 Days)

## Summary
- Average daily cost: $14.50
- Highest day: $28.75 (Nov 15) - VM provisioning spike
- Lowest day: $8.20 (Nov 3) - Weekend with auto-shutdown
- Overall trend: **Increasing 12% MoM**

## Week-over-Week Changes
- Week 1: $420 (baseline)
- Week 2: $385 (-8.3%) ‚úì Auto-shutdown improvements
- Week 3: $445 (+15.6%) ‚ö†Ô∏è New test VMs deployed
- Week 4: $520 (+16.9%) üî¥ VMs not shut down properly

## Recommendations
1. Review auto-shutdown schedules for test VMs
2. Implement budget alerts at $500/month
3. Consider Reserved Instances for persistent VMs
```

---

## Resource-Level Analysis

### 3. Most Expensive Resources

**Prompt to Claude:**
```
Identify the top 10 most expensive resources in my subscription.
For each, show:
- Current configuration
- Actual cost (last 30 days)
- Optimization opportunities
```

**PowerShell Analysis:**

```powershell
# Get all resources with costs
$resources = az resource list --output json | ConvertFrom-Json
$costs = az consumption usage list `
    --start-date (Get-Date).AddDays(-30).ToString('yyyy-MM-dd') `
    --end-date (Get-Date).ToString('yyyy-MM-dd') `
    --output json | ConvertFrom-Json

# Match resources to costs
$analysis = foreach ($resource in $resources) {
    $resourceCosts = $costs | Where-Object { $_.instanceId -eq $resource.id }
    $totalCost = ($resourceCosts | Measure-Object pretaxCost -Sum).Sum
    
    if ($totalCost -gt 0) {
        # Get resource details
        $details = az resource show --ids $resource.id --output json | ConvertFrom-Json
        
        [PSCustomObject]@{
            Name        = $resource.name
            Type        = $resource.type
            Location    = $resource.location
            Cost30Days  = [math]::Round($totalCost, 2)
            SKU         = $details.sku.name
            Size        = $details.properties.hardwareProfile.vmSize
            Tags        = ($resource.tags | ConvertTo-Json -Compress)
        }
    }
}

# Top 10 most expensive
$top10 = $analysis | Sort-Object Cost30Days -Descending | Select-Object -First 10

$top10 | Format-Table -AutoSize

# Detailed analysis for each
foreach ($item in $top10) {
    Write-Host "`n=== $($item.Name) ===" -ForegroundColor Yellow
    Write-Host "Cost: `$$($item.Cost30Days)"
    Write-Host "Type: $($item.Type)"
    Write-Host "Size: $($item.Size)"
    
    # Optimization suggestions
    if ($item.Type -like "*virtualMachines*") {
        Write-Host "`nOptimization Opportunities:" -ForegroundColor Cyan
        Write-Host "  - Enable auto-shutdown (save ~$([math]::Round($item.Cost30Days * 0.35, 2))/month)"
        Write-Host "  - Resize to smaller SKU if utilization < 50%"
        Write-Host "  - Consider Azure Hybrid Benefit (save 40-55%)"
    }
    
    if ($item.Type -like "*disks*") {
        Write-Host "`nOptimization Opportunities:" -ForegroundColor Cyan
        Write-Host "  - Switch to Standard SSD if Premium not needed"
        Write-Host "  - Delete unattached disks"
    }
}
```

---

### 4. Idle Resource Detection

**Prompt to Claude:**
```
Find resources that are running but not being used:
- VMs with low CPU utilization (<10%)
- Storage accounts with no access in 30 days
- Unattached disks
- Public IPs not associated with resources
Calculate waste and generate cleanup script
```

**Detection Script:**

```powershell
# Idle VM detection
Write-Host "=== Idle VMs (Low CPU Usage) ===" -ForegroundColor Yellow

$vms = az vm list --query "[].{Name:name, RG:resourceGroup, Location:location}" | ConvertFrom-Json

$idleVMs = foreach ($vm in $vms) {
    # Get average CPU over last 7 days
    $metrics = az monitor metrics list `
        --resource $(az vm show -g $vm.RG -n $vm.Name --query id -o tsv) `
        --metric "Percentage CPU" `
        --start-time (Get-Date).AddDays(-7).ToString('o') `
        --interval PT1H `
        --aggregation Average `
        --output json | ConvertFrom-Json
    
    $avgCPU = ($metrics.value.timeseries.data | Measure-Object average -Average).Average
    
    if ($avgCPU -lt 10) {
        $cost = az consumption usage list `
            --start-date (Get-Date).AddDays(-30).ToString('yyyy-MM-dd') `
            --end-date (Get-Date).ToString('yyyy-MM-dd') `
            --query "[?contains(instanceId, '$($vm.Name)')].pretaxCost" `
            --output json | ConvertFrom-Json | Measure-Object -Sum
        
        [PSCustomObject]@{
            Name            = $vm.Name
            ResourceGroup   = $vm.RG
            AvgCPU          = [math]::Round($avgCPU, 2)
            Cost30Days      = [math]::Round($cost.Sum, 2)
            Recommendation  = "Deallocate or downsize"
        }
    }
}

$idleVMs | Format-Table -AutoSize

# Unattached disks
Write-Host "`n=== Unattached Disks ===" -ForegroundColor Yellow

$disks = az disk list --query "[?diskState=='Unattached'].{Name:name, RG:resourceGroup, Size:diskSizeGb, SKU:sku.name}" --output json | ConvertFrom-Json

$diskWaste = 0
foreach ($disk in $disks) {
    # Estimate cost based on size and SKU
    $monthlyCost = switch ($disk.SKU) {
        "Premium_LRS" { $disk.Size * 0.135 }
        "StandardSSD_LRS" { $disk.Size * 0.075 }
        "Standard_LRS" { $disk.Size * 0.045 }
    }
    
    $diskWaste += $monthlyCost
    
    [PSCustomObject]@{
        Name          = $disk.Name
        ResourceGroup = $disk.RG
        SizeGB        = $disk.Size
        SKU           = $disk.SKU
        MonthlyCost   = [math]::Round($monthlyCost, 2)
    } | Format-Table -AutoSize
}

Write-Host "Total waste from unattached disks: `$$([math]::Round($diskWaste, 2))/month" -ForegroundColor Red

# Generate cleanup script
$cleanup = @"
# Cleanup script - Review before executing!

# Deallocate idle VMs (saves compute cost, keeps disks)
$(foreach ($vm in $idleVMs) {
    "az vm deallocate --resource-group $($vm.ResourceGroup) --name $($vm.Name)"
})

# Delete unattached disks (CAUTION: Cannot undo!)
$(foreach ($disk in $disks) {
    "# az disk delete --resource-group $($disk.RG) --name $($disk.Name) --yes"
})
"@

$cleanup | Set-Content "cleanup-idle-resources.sh"
Write-Host "`nCleanup script saved to: cleanup-idle-resources.sh"
Write-Host "REVIEW CAREFULLY before executing!" -ForegroundColor Red
```

---

## Optimization Opportunities

### 5. Right-Sizing Recommendations

**Prompt to Claude:**
```
Analyze all VMs and recommend right-sizing based on:
- CPU utilization (last 30 days)
- Memory usage
- Network throughput
Calculate potential savings for each recommendation
```

**Analysis:**

```powershell
# VM right-sizing analysis
$vms = az vm list --query "[].{Name:name, RG:resourceGroup, Size:hardwareProfile.vmSize}" | ConvertFrom-Json

$recommendations = foreach ($vm in $vms) {
    # Get performance metrics
    $vmId = az vm show -g $vm.RG -n $vm.Name --query id -o tsv
    
    # CPU utilization
    $cpu = az monitor metrics list `
        --resource $vmId `
        --metric "Percentage CPU" `
        --start-time (Get-Date).AddDays(-30).ToString('o') `
        --aggregation Average `
        --output json | ConvertFrom-Json
    
    $avgCPU = [math]::Round(($cpu.value.timeseries.data | Measure-Object average -Average).Average, 2)
    
    # Memory utilization (requires guest metrics)
    $memory = az monitor metrics list `
        --resource $vmId `
        --metric "Available Memory Bytes" `
        --start-time (Get-Date).AddDays(-30).ToString('o') `
        --aggregation Average `
        --output json 2>$null | ConvertFrom-Json
    
    # Current cost
    $cost = az consumption usage list `
        --start-date (Get-Date).AddDays(-30).ToString('yyyy-MM-dd') `
        --query "[?contains(instanceId, '$($vm.Name)')].pretaxCost" `
        --output json | ConvertFrom-Json | Measure-Object -Sum
    
    $currentCost = [math]::Round($cost.Sum, 2)
    
    # Recommendation logic
    $recommendation = if ($avgCPU -lt 15) {
        "Downsize by 2 tiers"
    } elseif ($avgCPU -lt 30) {
        "Downsize by 1 tier"
    } elseif ($avgCPU -gt 80) {
        "Upsize by 1 tier"
    } else {
        "Current size appropriate"
    }
    
    $potentialSavings = if ($recommendation -like "Down*") {
        [math]::Round($currentCost * 0.35, 2)
    } else {
        0
    }
    
    [PSCustomObject]@{
        VMName            = $vm.Name
        CurrentSize       = $vm.Size
        AvgCPU            = "$avgCPU%"
        CurrentCost       = "`$$currentCost"
        Recommendation    = $recommendation
        PotentialSavings  = "`$$potentialSavings/month"
    }
}

$recommendations | Format-Table -AutoSize

$totalSavings = ($recommendations | Where-Object { $_.PotentialSavings -ne "`$0/month" } | ForEach-Object { 
    [double]$_.PotentialSavings.Replace('$','').Replace('/month','')
} | Measure-Object -Sum).Sum

Write-Host "`nTotal potential savings: `$$totalSavings/month" -ForegroundColor Green
```

---

### 6. Reserved Instance Analysis

**Prompt to Claude:**
```
Analyze my VM usage patterns and recommend Reserved Instance purchases.
Show:
- VMs running 24/7
- Cost with pay-as-you-go vs 1-year RI vs 3-year RI
- Break-even point
- Total savings over 3 years
```

**RI Recommendation Script:**

```powershell
# Identify VMs suitable for Reserved Instances
$vms = az vm list --show-details --output json | ConvertFrom-Json

$riCandidates = foreach ($vm in $vms) {
    # Check uptime (VMs with >95% uptime are RI candidates)
    $metrics = az monitor metrics list `
        --resource $(az vm show -g $vm.resourceGroup -n $vm.name --query id -o tsv) `
        --metric "Percentage CPU" `
        --start-time (Get-Date).AddDays(-90).ToString('o') `
        --interval P1D `
        --output json | ConvertFrom-Json
    
    $daysRunning = ($metrics.value.timeseries.data | Where-Object { $_.average -gt 0 }).Count
    $uptimePercent = ($daysRunning / 90) * 100
    
    if ($uptimePercent -gt 95) {
        # Get current monthly cost
        $cost = az consumption usage list `
            --start-date (Get-Date).AddDays(-30).ToString('yyyy-MM-dd') `
            --query "[?contains(instanceId, '$($vm.name)')].pretaxCost" `
            --output json | ConvertFrom-Json | Measure-Object -Sum
        
        $monthlyCost = [math]::Round($cost.Sum, 2)
        
        # RI pricing (example - varies by region/size)
        # 1-year RI: ~40% savings
        # 3-year RI: ~60% savings
        $ri1Year = [math]::Round($monthlyCost * 0.60 * 12, 2)
        $ri3Year = [math]::Round($monthlyCost * 0.40 * 36, 2)
        $payAsYouGo3Year = [math]::Round($monthlyCost * 36, 2)
        
        [PSCustomObject]@{
            VMName               = $vm.name
            Size                 = $vm.hardwareProfile.vmSize
            Location             = $vm.location
            UptimePercent        = [math]::Round($uptimePercent, 1)
            MonthlyPAYG          = "`$$monthlyCost"
            Cost1YearRI          = "`$$ri1Year"
            Cost3YearRI          = "`$$ri3Year"
            Savings1Year         = "`$$([math]::Round(($monthlyCost * 12) - $ri1Year, 2))"
            Savings3Year         = "`$$([math]::Round($payAsYouGo3Year - $ri3Year, 2))"
            Recommendation       = "Purchase 3-year RI"
        }
    }
}

Write-Host "=== Reserved Instance Recommendations ===" -ForegroundColor Cyan
$riCandidates | Format-Table -AutoSize

$total3YearSavings = ($riCandidates | ForEach-Object { 
    [double]$_.Savings3Year.Replace('$','')
} | Measure-Object -Sum).Sum

Write-Host "`nTotal 3-year savings: `$$total3YearSavings" -ForegroundColor Green
Write-Host "Break-even period: ~4 months" -ForegroundColor Yellow
```

---

### 7. Azure Hybrid Benefit

**Prompt to Claude:**
```
Check which VMs are eligible for Azure Hybrid Benefit.
Calculate savings if we enable it.
```

```powershell
# Check Windows VMs eligible for Azure Hybrid Benefit
$windowsVMs = az vm list --query "[?storageProfile.osDisk.osType=='Windows']" | ConvertFrom-Json

foreach ($vm in $windowsVMs) {
    $details = az vm show -g $vm.resourceGroup -n $vm.name --output json | ConvertFrom-Json
    
    $hasAHB = $details.licenseType -eq "Windows_Server"
    
    if (-not $hasAHB) {
        # Calculate savings (typically 40% for Windows Server)
        $cost = az consumption usage list `
            --start-date (Get-Date).AddDays(-30).ToString('yyyy-MM-dd') `
            --query "[?contains(instanceId, '$($vm.name)')].pretaxCost" `
            --output json | ConvertFrom-Json | Measure-Object -Sum
        
        $savings = [math]::Round($cost.Sum * 0.40, 2)
        
        Write-Host "VM: $($vm.name)" -ForegroundColor Yellow
        Write-Host "  Current monthly cost: `$$([math]::Round($cost.Sum, 2))"
        Write-Host "  Potential savings with AHB: `$$savings/month" -ForegroundColor Green
        Write-Host "  Command to enable:"
        Write-Host "  az vm update -g $($vm.resourceGroup) -n $($vm.name) --license-type Windows_Server" -ForegroundColor Cyan
    }
}
```

---

## Reporting & Dashboards

### 8. Executive Cost Summary

**Prompt to Claude:**
```
Create an executive summary report for last month's Azure spending.
Include:
- Total spend vs budget
- Top 5 cost drivers
- Month-over-month change
- Optimization opportunities
- Action items
Format as markdown for email
```

**Generated Report:**

```markdown
# Azure Cost Summary - November 2025

## Executive Summary
**Total Spend:** $3,847.52  
**Budget:** $4,000.00  
**Variance:** -$152.48 (3.8% under budget) ‚úì

**Month-over-Month:** +12.4% ($425 increase)  
**Primary Driver:** New production environment deployment

---

## Top Cost Drivers

| Resource Type | November Cost | % of Total | Change vs October |
|---------------|---------------|------------|-------------------|
| Virtual Machines | $1,842.30 | 47.9% | +18% üî¥ |
| Azure SQL Database | $875.25 | 22.7% | +5% |
| Storage Accounts | $412.50 | 10.7% | -2% ‚úì |
| Application Gateway | $385.00 | 10.0% | New |
| Log Analytics | $332.47 | 8.6% | +12% |

---

## Key Findings

### 1. VM Cost Increase
**Issue:** Production VMs not using auto-shutdown  
**Impact:** ~$540/month in unnecessary compute  
**Action:** Implement auto-shutdown for dev/test VMs

### 2. Unused Resources
**Issue:** 8 unattached disks ($127/month)  
**Impact:** Pure waste  
**Action:** Delete after backup confirmation

### 3. Missing Azure Hybrid Benefit
**Issue:** 5 Windows VMs not using AHB  
**Impact:** $685/month overspend  
**Action:** Enable AHB (requires licensing review)

---

## Optimization Opportunities

**Immediate (0-30 days):**
- Enable auto-shutdown: **$540/month savings**
- Delete unattached disks: **$127/month savings**
- Right-size oversized VMs: **$285/month savings**
**Total: $952/month (24.7% reduction)**

**Short-term (30-90 days):**
- Purchase Reserved Instances: **$620/month savings**
- Enable Azure Hybrid Benefit: **$685/month savings**
**Total: $1,305/month (33.9% reduction)**

**Combined Potential Savings:** $2,257/month (58.7%)

---

## Action Items

**By Nov 30:**
1. ‚úÖ Enable auto-shutdown on all dev/test VMs
2. ‚è≥ Review and delete unattached disks
3. ‚è≥ Right-size VMs with <30% utilization

**By Dec 15:**
4. ‚è≥ Windows licensing audit for AHB eligibility
5. ‚è≥ Reserved Instance analysis and purchase

**By Dec 31:**
6. ‚è≥ Implement cost allocation tags
7. ‚è≥ Set up automated cost reports

---

## Budget Forecast

**December Projection:** $3,200 (with auto-shutdown)  
**Q1 2026 Average:** $2,900 (with all optimizations)

---

*Report generated: 2025-11-17 | Data source: Azure Cost Management API*
```

---

## Automation Scripts

### 9. Daily Cost Alert

**Prompt to Claude:**
```
Create a script that runs daily and alerts me if:
- Daily spend exceeds $150
- Any single resource costs >$50/day
- Month-to-date spend is >80% of budget
Send email with details
```

**Automated Alert Script:**

```powershell
# daily-cost-alert.ps1
param(
    [string]$BudgetAmount = 4000,
    [string]$AlertEmail = "admin@example.com"
)

$today = (Get-Date).ToString('yyyy-MM-dd')
$monthStart = (Get-Date -Day 1).ToString('yyyy-MM-dd')

# Get today's costs
$todayCosts = az consumption usage list `
    --start-date $today `
    --end-date $today `
    --query "[].pretaxCost" `
    --output json | ConvertFrom-Json | Measure-Object -Sum

$dailySpend = [math]::Round($todayCosts.Sum, 2)

# Get month-to-date
$mtdCosts = az consumption usage list `
    --start-date $monthStart `
    --end-date $today `
    --query "[].pretaxCost" `
    --output json | ConvertFrom-Json | Measure-Object -Sum

$mtdSpend = [math]::Round($mtdCosts.Sum, 2)
$budgetPercent = ($mtdSpend / $BudgetAmount) * 100

# Alerts
$alerts = @()

if ($dailySpend -gt 150) {
    $alerts += "üî¥ Daily spend ($dailySpend) exceeds $150 threshold"
}

if ($budgetPercent -gt 80) {
    $alerts += "‚ö†Ô∏è MTD spend ($mtdSpend) is $([math]::Round($budgetPercent, 1))% of budget"
}

# Check individual resources
$expensiveResources = az consumption usage list `
    --start-date $today `
    --end-date $today `
    --output json | ConvertFrom-Json | 
    Group-Object instanceName | 
    ForEach-Object {
        $cost = ($_.Group | Measure-Object pretaxCost -Sum).Sum
        if ($cost -gt 50) {
            [PSCustomObject]@{
                Resource = $_.Name
                Cost     = [math]::Round($cost, 2)
            }
        }
    }

if ($expensiveResources) {
    $alerts += "üí∞ Expensive resources detected:"
    foreach ($res in $expensiveResources) {
        $alerts += "  - $($res.Resource): `$$($res.Cost)"
    }
}

# Send alert if any triggers
if ($alerts.Count -gt 0) {
    $body = @"
Azure Cost Alert - $(Get-Date -Format 'yyyy-MM-dd')

Daily Spend: `$$dailySpend
MTD Spend: `$$mtdSpend / `$$BudgetAmount ($([math]::Round($budgetPercent, 1))%)

Alerts:
$($alerts -join "`n")

Review in Azure Cost Management:
https://portal.azure.com/#blade/Microsoft_Azure_CostManagement/Menu/overview
"@
    
    # Send email (requires SMTP configuration)
    Send-MailMessage `
        -From "azure-alerts@example.com" `
        -To $AlertEmail `
        -Subject "Azure Cost Alert - $([math]::Round($dailySpend, 0)) today" `
        -Body $body `
        -SmtpServer "smtp.company.com"
    
    Write-Host "Alert sent: $($alerts.Count) issues detected"
} else {
    Write-Host "No alerts - spending within normal range"
}
```

**Schedule with Task Scheduler:**
```powershell
# Create scheduled task
$action = New-ScheduledTaskAction -Execute "PowerShell.exe" `
    -Argument "-File C:\Scripts\daily-cost-alert.ps1"

$trigger = New-ScheduledTaskTrigger -Daily -At 6AM

Register-ScheduledTask `
    -TaskName "Azure Daily Cost Alert" `
    -Action $action `
    -Trigger $trigger `
    -Description "Daily Azure cost monitoring"
```

---

## Budget Management

### 10. Budget Creation and Monitoring

**Prompt to Claude:**
```
Set up budgets for:
- $4000/month at subscription level
- $1000/month per resource group
- $500/month for dev/test resources
Configure alerts at 80%, 90%, 100%
```

**Budget Creation Script:**

```powershell
# Create subscription-level budget
az consumption budget create `
    --budget-name "Monthly-Subscription-Budget" `
    --amount 4000 `
    --time-grain Monthly `
    --start-date (Get-Date -Day 1).ToString('yyyy-MM-01') `
    --end-date (Get-Date -Day 1).AddYears(1).ToString('yyyy-MM-01') `
    --notifications `
        threshold=80 `
        contactEmails="admin@example.com" `
        thresholdType=Actual `
    --notifications `
        threshold=90 `
        contactEmails="admin@example.com,manager@example.com" `
        thresholdType=Actual `
    --notifications `
        threshold=100 `
        contactEmails="admin@example.com,manager@example.com,finance@example.com" `
        thresholdType=Actual

# Create resource group budgets
$resourceGroups = az group list --query "[].name" --output json | ConvertFrom-Json

foreach ($rg in $resourceGroups) {
    $budgetAmount = if ($rg -like "*dev*" -or $rg -like "*test*") { 500 } else { 1000 }
    
    az consumption budget create `
        --budget-name "$rg-Monthly-Budget" `
        --amount $budgetAmount `
        --time-grain Monthly `
        --resource-group $rg `
        --start-date (Get-Date -Day 1).ToString('yyyy-MM-01') `
        --end-date (Get-Date -Day 1).AddYears(1).ToString('yyyy-MM-01') `
        --notifications `
            threshold=80 `
            contactEmails="teamlead@example.com"
    
    Write-Host "Created budget for $rg`: `$$budgetAmount/month"
}
```

---

## Next Steps

- Review [Automation Scenarios](automation-scenarios.md) for full workflows
- Check [Query Resources](query-resources.md) for infrastructure analysis
- See [Architecture Documentation](../docs/architecture.md) for system design

**Remember:** Cost optimization is ongoing. Schedule monthly reviews and automate monitoring!
